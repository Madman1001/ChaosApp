package com.lhr.test.vpn

import com.lhr.vpn.socks.net.v4.ChecksumUtil
import com.lhr.vpn.socks.net.v4.NetPacket
import org.junit.Test

/**
 * @CreateDate: 2022/10/12
 * @Author: mac
 * @Description:
 */
class NetTest {

    @Test
    fun ipReadTest(){
        val i = ((4 shl 4) or (5 + 0 / 4)).toByte()

        println(i)
        println(4 shl 4)
        println(5 + 0 / 4)

    }

    val ipPacketArray = byteArrayOf(
        0x45, 0x00, 0x05,
        0xDC.toByte(),
        0xAD.toByte(), 0x7E, 0x40, 0x00, 0x40, 0x06, 0x01, 0x52,
        0xC0.toByte(),
        0xA8.toByte(), 0x02, 0x02,
        0xC0.toByte(),
        0xA8.toByte(), 0x02,
        0xF9.toByte(),
        0xB5.toByte(), 0x26,
        0xA7.toByte(), 0x39, 0x6D, 0x3D,
        0xCE.toByte(), 0x6C,
        0xE5.toByte(), 0x27,
        0xB6.toByte(), 0x58,
        0x80.toByte(), 0x10, 0x01, 0x58,
        0xB4.toByte(),
        0xB2.toByte(), 0x00, 0x00, 0x01, 0x01, 0x08, 0x0A, 0x0A, 0x18, 0x63, 0x18,
        0x0A, 0x18, 0x63, 0x11, 0x3A, 0x5B, 0x31, 0x39, 0x32, 0x2E, 0x31, 0x36, 0x38, 0x2E, 0x32, 0x2E,
        0x32, 0x34, 0x39, 0x3A, 0x38, 0x30, 0x38, 0x30, 0x5D, 0x3C, 0x62, 0x72, 0x2F, 0x3E, 0x55, 0x73,
        0x65, 0x72, 0x2D, 0x61, 0x67, 0x65, 0x6E, 0x74, 0x3A, 0x5B, 0x44, 0x61, 0x6C, 0x76, 0x69, 0x6B,
        0x2F, 0x32, 0x2E, 0x31, 0x2E, 0x30, 0x20, 0x28, 0x4C, 0x69, 0x6E, 0x75, 0x78, 0x3B, 0x20, 0x55,
        0x3B, 0x20, 0x41, 0x6E, 0x64, 0x72, 0x6F, 0x69, 0x64, 0x20, 0x37, 0x2E, 0x30, 0x3B, 0x20, 0x4F,
        0x4E, 0x45, 0x50, 0x4C, 0x55, 0x53, 0x20, 0x41, 0x33, 0x30, 0x31, 0x30, 0x20, 0x42, 0x75, 0x69,
        0x6C, 0x64, 0x2F, 0x4E, 0x52, 0x44, 0x39, 0x30, 0x4D, 0x29, 0x5D,
        0xE8.toByte(),
        0xAF.toByte(),
        0xB7.toByte(),
        0xE6.toByte(),
        0xB1.toByte(),
        0x82.toByte(),
        0xE6.toByte(),
        0x96.toByte(),
        0xB9.toByte(),
        0xE6.toByte(),
        0xB3.toByte(),
        0x95.toByte(),
        0xEF.toByte(),
        0xBC.toByte(),
        0x9A.toByte(), 0x47, 0x45, 0x54, 0x3C, 0x62, 0x72,
        0x2F, 0x3E,
        0xE8.toByte(),
        0xAF.toByte(),
        0xB7.toByte(),
        0xE6.toByte(),
        0xB1.toByte(),
        0x82.toByte(),
        0xE5.toByte(),
        0x8F.toByte(),
        0x82.toByte(),
        0xE6.toByte(),
        0x95.toByte(),
        0xB0.toByte(),
        0xEF.toByte(),
        0xBC.toByte(),
        0x9A.toByte(), 0x6E, 0x75, 0x6C, 0x6C, 0x3C, 0x62, 0x72, 0x2F, 0x3E,
        0xE8.toByte(),
        0xAF.toByte(),
        0xB7.toByte(),
        0xE6.toByte(),
        0xB1.toByte(),
        0x82.toByte(),
        0xE5.toByte(),
        0xA4.toByte(),
        0xB4.toByte(),
        0xEF.toByte(),
        0xBC.toByte(),
        0x9A.toByte(), 0x3C, 0x62, 0x72, 0x2F, 0x3E, 0x41, 0x63, 0x63, 0x65, 0x70,
        0x74, 0x2D, 0x65, 0x6E, 0x63, 0x6F, 0x64, 0x69, 0x6E, 0x67, 0x3A, 0x5B, 0x67, 0x7A, 0x69, 0x70,
        0x5D, 0x3C, 0x62, 0x72, 0x2F, 0x3E, 0x43, 0x6F, 0x6E, 0x6E, 0x65, 0x63, 0x74, 0x69, 0x6F,
  )

    @Test
    fun checksum(){
        val netPacket = NetPacket(ipPacketArray)
        println(ipPacketArray.size)
        println(netPacket.ipHeader)
        println(netPacket.tcpHeader)
        println(String(netPacket.data))
        assert(netPacket.checkIpChecksum())
        assert(netPacket.checkTcpUdpChecksum())
    }
}